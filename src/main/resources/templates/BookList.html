<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- ë°‘ì˜ë‚´ìš©ë¶€í„° content layoutì— ë“¤ì–´ê°€ë‹ˆê¹ ì´ ë‚´ìš©ì´ charset=UTF-8ë¼ëŠ” ê±¸ ì ì–´ì•¼ í•œê¸€ì´ ì•ˆê¹¨ì§ -->
<div layout:fragment="content" >

<link rel="stylesheet" type="text/css" href="css/BookList.css">
<style>

.searchResult_box{

	text-align: center;
	margin-bottom: 100px;
	font-size: 25px;
	font-weight: bold;
	color: blue;
	
}

</style>

<script type="text/javascript" src="/js/ajaxUtil.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>


<br/><br/><br/><br/>
<br/><br/><br/><br/>

<!-- ì™œ string íƒ€ì…ì˜ nullì´ë¼ëŠ” ê¸€ìê°€ ë“¤ì–´ê°”ì„ê¹Œ -->
<div th:if="${searchKey}=='null'" class="searchResult_box">í•´ë‹¹ ê²Œì‹œë¬¼ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>

<div th:if="${searchValue != '' and searchKey == 'title_Nm'}" class="searchResult_box">'[[${searchValue}]]'ë¡œ ê²€ìƒ‰í•œ ê²°ê³¼ [[${dataCount}]]ê°œê°€ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.</p></div>

<div class="BookList-container" th:each="i : ${#numbers.sequence(0,2)}" th:if="${#lists.size(lists)}>0">
	<div class="BookList-row" th:each="j : ${#numbers.sequence(0,2)}">
		
		<div class="BookList-img-box" th:each="dto: ${lists[3*i+j]}" style=" line-height: 1.8; "> 
			
			<a th:href="@{${articleUrl}} + '&seq_No=' + @{${dto.seq_No}}">
			<img alt="ìƒí’ˆ ì¤€ë¹„ì¤‘" th:src="@{${dto.image_Url}}"></a><br/><br/>
			
			<h5>[[${dto.title_Nm}]]</h5>
         <span>[[${dto.authr_Nm}]]</span><br/>
         <span>[[${dto.publisher_Nm}]]</span><br/>
         <span>ê°€ê²©: [[${#numbers.formatInteger(dto.prc_Value, 1,'COMMA')}]]ì›</span>
			
			
			<div th:id="${dto.seq_No}" >
			<a th:onclick="|javascript:sendBag('${dto.seq_No}')|"><button style="background-color: #fff; font-size: 20px;" type="button">ğŸ¤</button></a>
			</div>
			<div th:id="'delete' + ${dto.seq_No}" style="display: none;">
			<a th:onclick="|javascript:sendDeleteBag('${dto.seq_No}')|"><button style="background-color: #fff; font-size: 20px;" type="button">â¤ï¸</button></a>
			</div>
		
		</div>

	</div>
</div>

<br/>

<div style="text-align: right; margin-right: 200px;">
	<button th:if="${RULE == 'RULE_ADMIN'}" class="btn-555 float-r" th:onclick="|location.href='@{BookCreated.action}'|">ë“±ë¡í•˜ê¸°</button>
</div>

<div style="text-align: center; padding-left: 5%;">
<a th:utext="${pageIndexList}"></a>
</div>
<br/><br/><br/><br/>

<script th:inline="javascript">

function sendBag(seq_No){
	
	if(seq_No==""){
		
		return;
	}
	if([[${session.OauthUser == null and session.user == null}]]){
		//session.user.userId ì´ê±´ ë¹„êµí•  ìˆ˜ ì—†ìŒ session.userëŠ” ë¹„êµê°€ ë¨
		//userê°€ ì—†ìœ¼ë©´ ì• ì‹œë‹¹ì´ˆ userIdë¥¼ ì°¾ì„ ìˆ˜ê°€ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë‚¨ ê·¸ë˜ì„œ ë”± session.userê¹Œì§€ë§Œ ë¹„êµë¥¼ í•´ì•¼ í•¨
		
		alertLogin();

		
	}else if([[${session.OauthUser != null or session.user != null}]]){
		
		var params = "seq_No=" + seq_No;

		sendRequest("/insertItem.action",params,returnBag,"POST");
		//ì£¼ì˜ : callbackí•¨ìˆ˜ê°€ ìˆìœ¼ë©´ jsoní˜•íƒœë¡œ ê°’ì„ ë¬´ì¡°ê±´ ë°˜í™˜í•´ì£¼ê¸° ë•Œë¬¸ì— ì¤‘ê°„ì— redirectê°™ì€ ê²ƒì´ ì•ˆ ë¨
		
	}

}

function returnBag(){
	
	if(httpRequest.readyState==4){
		
		if(httpRequest.status==200){

			var text = httpRequest.responseText;
			var resultText = JSON.parse(text);
			var count = Object.keys(resultText.lists).length;

			for(var i=0;i<count;i++){

				showLike(resultText.lists[i].seq_No);
				
			}
		
		}
		
	}
	
}

function sendDeleteBag(seq_No){

	if(seq_No==""){
		
		return;
		
	}
	
	if([[${session.OauthUser == null and session.user == null}]]){
		
		alert("ë¡œê·¸ì¸ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤");
		
		window.location.href="/main";
		
	}else if([[${session.OauthUser != null or session.user != null}]]){
		
		var params = "seq_No=" + seq_No;
		
		sendRequest("/deleteItem.action",params,returnDeleteBag,"POST");
		
	}
	
}

function returnDeleteBag(){
	
	if(httpRequest.readyState==4){
		
		if(httpRequest.status==200){
			
			var text = httpRequest.responseText;
			var resultText = JSON.parse(text);
			
			hideLike(resultText.bagDTO.seq_No);

		}
		
	}
	
}

function sendAllItem(){
	
	if([[${session.OauthUser != null or session.user != null}]]){
		
		var params = null;
		
		sendRequest("/selectItem.action",params,returnBag,"POST");
		
	}

}

window.onload = function(){
	
	sendAllItem();
	//navbar.html í•˜ì´ë“œ ì—¬ê¸°ì„œ ì‹¤í–‰ì´ ì•ˆë¨ why? window.onloadê°€ 2ë²ˆ ê²¹ì³ì„œ ê·¸ëŸ¼  ê·¸ë˜ì„œ hide();ë¥¼ ì—¬ê¸°ì„œ ì¨ì¤Œ
	hide();
	
}

function showLike(seq_No) {

	var beforeItem = document.getElementById(seq_No);
	//beforeItemì´ nullê°’ì´ ë‚˜ì˜¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ì´ ì•ˆë¨ ê·¸ë˜ì„œ ifìœ¼ë¡œ ê±¸ëŸ¬ì•¼ë¨
	if(beforeItem!=null){

		var d_No = "delete" + seq_No;
		
		beforeItem.style.display = "none";
		
		var afterItem = document.getElementById(d_No);
		afterItem.style.display = "block";
		
	}

}

function hideLike(seq_No) {
	
	var d_No = "delete" + seq_No;

	var beforeItem = document.getElementById(seq_No);
	beforeItem.style.display = "block";

	var afterItem = document.getElementById(d_No);
	afterItem.style.display = "none";
	
}

function alertLogin(){
	
	Swal.fire({
		  title: 'ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”',
		  icon: 'error',
		  iconHtml: 'X',
		  confirmButtonText: 'í™•ì¸',
		  cancelButtonText: 'ì·¨ì†Œ',
		  showCancelButton: true,
		  showCloseButton: true
		}).then((result)=>{
			
			if(result.value){
				
				window.location.href='/user/login';
				
			}
			
		});

}


</script>

</div>
</html>